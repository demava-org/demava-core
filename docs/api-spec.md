# Demava API Specification

This document outlines the core API endpoints and data models for Demava’s backend services. The API is RESTful (with potential GraphQL layer in the future) and supports secure, scalable access to user, proposal, and voting data.

---

## 🔐 Authentication

### POST `/auth/register`

* **Input:** `name`, `email`, `password`, `field`, `region`
* **Returns:** JWT token

### POST `/auth/login`

* **Input:** `email`, `password`
* **Returns:** JWT token

### GET `/auth/me`

* **Auth Required**
* **Returns:** current user profile

---

## 👤 Users

### GET `/users/{id}`

* Fetch a user by ID

### PATCH `/users/{id}`

* Update profile fields (e.g., bio, avatar, field)

### GET `/users/me/votes`

* Return all votes the user has submitted

---

## 📄 Proposals

### GET `/proposals`

* Query parameters: `field`, `region`, `layer`, `status`
* Returns a list of proposals matching filters

### GET `/proposals/{id}`

* Return proposal detail

### POST `/proposals`

* Auth required
* **Input:** `title`, `description`, `field`, `layer`
* **Returns:** created proposal ID

### PATCH `/proposals/{id}`

* Update title, description (draft only)

### GET `/proposals/{id}/summary`

* Returns AI-generated summary (if available)

### GET `/proposals/{id}/votes`

* List votes cast on a proposal (with anonymized data)

---

## 🗳️ Voting

### POST `/votes`

* Auth required
* **Input:** `proposal_id`, `value` (e.g., `yes`, `no`, `abstain`)
* **Validations:** 1 vote per user per proposal per layer

### GET `/votes/{proposal_id}/result`

* Aggregated tally of results (e.g., yes/no/abstain %, quorum, total)

---

## 🧠 AI Services

### POST `/ai/proposal-assist`

* Input: `raw_idea_text`
* Output: Cleaned, structured proposal using GenAI

### GET `/ai/summary/{proposal_id}`

* Return summary or explanation generated by AI

### POST `/ai/moderate`

* Input: `text`
* Output: Flag status (`safe`, `toxic`, `needs review`)

---

## 🗂️ Metadata

### GET `/fields`

* Returns all domains of expertise (e.g., Medicine, Arts)

### GET `/regions`

* Returns hierarchical region data (e.g., city > province > country)

### GET `/layers`

* Return structure of governance layers (Layer 1–10)

---

## 💬 Comments (Future)

### GET `/proposals/{id}/comments`

* List threaded discussion

### POST `/proposals/{id}/comments`

* Add comment, reply, or reaction

---

## 📦 Status Codes

* `200 OK`
* `201 Created`
* `204 No Content`
* `400 Bad Request`
* `401 Unauthorized`
* `403 Forbidden`
* `404 Not Found`
* `409 Conflict`
* `500 Internal Server Error`

---

> For authentication, each request must include the JWT token in the `Authorization: Bearer <token>` header.

---

Future enhancements will include:

* WebSocket support for real-time voting
* Webhook support for orgs (e.g., proposal created, vote passed)
* GraphQL schema (planned Q4 2025)

For architecture and roadmap, see `/docs/architecture.md` and `/docs/roadmap.md`
